# YOLOv11 CNR Park - DetecÃ§Ã£o de Vagas de Estacionamento

## ğŸ“‹ DescriÃ§Ã£o

Este projeto implementa um sistema de **detecÃ§Ã£o de vagas de estacionamento ocupadas e disponÃ­veis** utilizando **YOLOv11** com otimizaÃ§Ã£o de hiperparÃ¢metros via **Optuna** (otimizaÃ§Ã£o bayesiana). O modelo foi treinado no dataset **CNRPark**, que contÃ©m 2.926 imagens anotadas em formato YOLO Oriented Object Detection.

## ğŸ¯ Objetivo

Desenvolver um modelo de visÃ£o computacional capaz de:
- Detectar vagas de estacionamento em imagens
- Classificar vagas como **ocupadas (0)** ou **disponÃ­veis (1)**
- Otimizar o desempenho atravÃ©s de busca de hiperparÃ¢metros automatizada

## ğŸ“Š Dataset

### CNRPark v2
- **Total de imagens**: 2.926
- **Tamanho**: 640x640 pixels
- **Classes**: 2 (0: ocupado, 1: disponÃ­vel)
- **AnotaÃ§Ãµes**: YOLOv8 Oriented Object Detection Format

**Download do dataset**: https://universe.roboflow.com/projects-oqpad/cnrpark-hnvuk/dataset/2

### PrÃ©-processamento aplicado:
- Auto-orientaÃ§Ã£o de dados de pixel (remoÃ§Ã£o de EXIF-orientation)
- Redimensionamento para 640x640 (Stretch)

### AumentaÃ§Ã£o de dados:
- Probabilidade de flip horizontal: 50%
- Probabilidade de flip vertical: 50%
- Ajuste de brilho aleatÃ³rio: -21% a +21%
- Desfoque Gaussiano aleatÃ³rio: 0 a 1.7 pixels

## ğŸ—ï¸ Estrutura do Projeto

```
yoloCNR/
â”œâ”€â”€ data.yaml                 # ConfiguraÃ§Ã£o do dataset
â”œâ”€â”€ yolo11teste.py           # Script principal de treinamento com Optuna
â”œâ”€â”€ README.MD                # Este arquivo
â”œâ”€â”€ README.roboflow.txt      # InformaÃ§Ãµes do Roboflow
â”œâ”€â”€ train/                   # Dados de treinamento
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ labels/
â”œâ”€â”€ valid/                   # Dados de validaÃ§Ã£o
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ labels/
â””â”€â”€ test/                    # Dados de teste
    â”œâ”€â”€ images/
    â””â”€â”€ labels/
```

## ğŸš€ Como Usar

### 1. PrÃ©-requisitos

```bash
pip install ultralytics optuna
```

### 2. Configurar o Dataset

Baixe o dataset do CNRPark:
1. Acesse: https://universe.roboflow.com/projects-oqpad/cnrpark-hnvuk/dataset/2
2. Extraia os arquivos na pasta do projeto
3. Verifique se o arquivo `data.yaml` estÃ¡ configurado corretamente

### 3. Executar o Treinamento com OtimizaÃ§Ã£o

```bash
# Treinamento com 30 trials de otimizaÃ§Ã£o
python yolo11teste.py --trials 30 --study-name meu_estudo

# Com armazenamento persistente (SQLite)
python yolo11teste.py --trials 30 --study-name meu_estudo --storage sqlite:///optuna.db

# Apenas treino final com melhores hiperparÃ¢metros
python yolo11teste.py --final --study-name meu_estudo --storage sqlite:///optuna.db
```

### Argumentos disponÃ­veis:
- `--trials`: NÃºmero de trials de otimizaÃ§Ã£o (padrÃ£o: 20)
- `--study-name`: Nome do estudo Optuna (padrÃ£o: yolov11_optuna)
- `--storage`: URI de armazenamento SQLite (ex: sqlite:///optuna.db)
- `--final`: Executar apenas o treino final com melhores hiperparÃ¢metros

## âš™ï¸ ConfiguraÃ§Ãµes de Treinamento

### HiperparÃ¢metros otimizados pelo Optuna:
- **Batch size**: [64, 128, 256]
- **Learning rate (lr0)**: 1e-10 a 1e-2
- **Optimizer**: SGD, Adam, Adamax
- **Weight decay**: 5e-5 a 5e-2

### Ã‰pocas:
- **Trials**: 5 Ã©pocas (avaliaÃ§Ã£o rÃ¡pida)
- **Treinamento final**: 300 Ã©pocas

### Modelo base:
- **YOLOv11 Nano** (yolo11n-obb.pt) - para detecÃ§Ã£o orientada

## ğŸ“ˆ Resultados

Os resultados do treinamento sÃ£o salvos em `runs/optuna_yolov11/` com:
- Checkpoints do modelo
- MÃ©tricas de validaÃ§Ã£o
- Arquivos de configuraÃ§Ã£o

## ğŸ” Estrutura do Script Principal

O script `yolo11teste.py` implementa:

1. **FunÃ§Ã£o objetivo** (`objective`): 
   - Sugere hiperparÃ¢metros via Optuna
   - Treina o modelo com poucos epochs
   - Valida e retorna mAP

2. **ExecuÃ§Ã£o Optuna** (`run_optuna`):
   - Cria estudo com maximizaÃ§Ã£o de mAP
   - Executa N trials
   - Salva melhores parÃ¢metros

3. **Treinamento final** (`final_train`):
   - Treina modelo com melhores hiperparÃ¢metros
   - 300 epochs para melhor desempenho

## ğŸ“ Notas Importantes

- O script utiliza **GPU (device=0)** por padrÃ£o. Altere em `yolo11teste.py` se necessÃ¡rio
- Cada trial roda um treinamento curto para avaliaÃ§Ã£o rÃ¡pida de hiperparÃ¢metros
- O treinamento final Ã© automaticamente executado ao final
- Os resultados sÃ£o persistentes se usar `--storage` com SQLite

## ğŸ”— ReferÃªncias

- **YOLOv11**: https://github.com/ultralytics/ultralytics
- **Optuna**: https://optuna.org/
- **Dataset CNRPark**: https://universe.roboflow.com/projects-oqpad/cnrpark-hnvuk/dataset/2
- **Roboflow**: https://roboflow.com

## ğŸ“¦ DependÃªncias

```
ultralytics>=8.0.0
optuna>=3.0.0
```

## ğŸ“ Contexto

Projeto desenvolvido como parte de uma pesquisa em **CiÃªncia da ComputaÃ§Ã£o** focando em:
- DetecÃ§Ã£o de objetos em tempo real
- OtimizaÃ§Ã£o de modelos de deep learning
- AplicaÃ§Ãµes de visÃ£o computacional em ambientes urbanos

---

**Dataset Source**: https://universe.roboflow.com/projects-oqpad/cnrpark-hnvuk/dataset/2